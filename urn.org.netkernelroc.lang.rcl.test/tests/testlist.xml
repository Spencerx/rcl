<testlist>
  <import>res:/org/netkernel/xml/assert/assertLibrary.xml</import>

  <test name="Simple template processing">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div>
            <p>This is a template</p>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <xpath>/div</xpath>
      <xpath>/div/p</xpath>
      <xpath>/div/p/text()='This is a template'</xpath>
    </assert>
  </test>

  <test name="rcl:include with one XML child">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <p>This is a template</p>
            <rcl:include>
              <div>Simple content.</div>
            </rcl:include>
            <p>Stuff at the end.</p>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <xpath>/div[count(namespace::*)=1]</xpath>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div</xpath>
      <xpath>/div/div</xpath>
      <xpath>/div/div/text()='Simple content.'</xpath>
    </assert>
  </test>

  <test name="rcl:include with two XML children">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <p>This is a template</p>
            <rcl:include>
              <div>Simple content.</div>
              <div>More content.</div>
            </rcl:include>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div</xpath>
      <xpath>/div/div</xpath>
      <xpath>/div/div[1]/text()='Simple content.'</xpath>
      <xpath>/div/div[2]/text()='More content.'</xpath>
    </assert>
  </test>

  <test name="rcl:include with one rcl:request child">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <p>This is a template</p>
            <rcl:include>
              <rcl:request>
                <rcl:identifier>res:/resources/simple-content.xml</rcl:identifier>
              </rcl:request>
            </rcl:include>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div</xpath>
      <xpath>/div/div</xpath>
      <xpath>/div/div/text()='Simple content.'</xpath>
    </assert>
  </test>

  <test name="rcl:include with one rcl:request and one XML child">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <p>This is a template</p>
            <rcl:include>
              <p>Include this paragraph</p>
              <rcl:request>
                <rcl:identifier>res:/resources/simple-content.xml</rcl:identifier>
              </rcl:request>
            </rcl:include>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div</xpath>
      <xpath>/div/div</xpath>
      <xpath>/div/p[1]/text()='This is a template'</xpath>
      <xpath>/div/p[2]/text()='Include this paragraph'</xpath>
      <xpath>/div/div/text()='Simple content.'</xpath>
    </assert>
  </test>

  <test name="Simple recursion - one include within another">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <rcl:include>
              <p>Top level before</p>
              <rcl:include>
                <p>Nested include paragraph</p>
                <p>Nested include paragraph</p>
                <p>Nested include paragraph</p>
              </rcl:include>
            </rcl:include>
            <p>Top level after</p>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div</xpath>
      <xpath>/div/p[1]/text()='Top level before'</xpath>
      <xpath>/div/p[2]/text()='Nested include paragraph'</xpath>
      <xpath>/div/p[3]/text()='Nested include paragraph'</xpath>
      <xpath>/div/p[4]/text()='Nested include paragraph'</xpath>
      <xpath>/div/p[5]/text()='Top level after'</xpath>
    </assert>
  </test>

  <test name="Nested include">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <div>
              <div>
                <rcl:include>
                  <p>Include this paragraph</p>
                </rcl:include>
              </div>
            </div>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div/div/div/p</xpath>
      <xpath>/div/div/div/p/text()='Include this paragraph'</xpath>
    </assert>
  </test>

  <test name="Simple rcl:if with true response">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Response true</p>
              </rcl:true>
              <rcl:false>
                <p>Response false</p>
              </rcl:false>
            </rcl:if>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div/p/text()='Response true'</xpath>
    </assert>
  </test>

  <test name="Simple rcl:if with only true response">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Response true</p>
              </rcl:true>
            </rcl:if>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <xpath>/div/p/text()='Response true'</xpath>
    </assert>
  </test>

  <test name="Simple rcl:if with only missing rcl:true response">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:false>
                <p>Response false</p>
              </rcl:false>
            </rcl:if>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div</xpath>
      <xpath>/div[count(p)=0]</xpath>
    </assert>
  </test>

  <test name="Simple rcl:if with false response">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:false</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Response true</p>
              </rcl:true>
              <rcl:false>
                <p>Response false</p>
              </rcl:false>
            </rcl:if>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div/p/text()='Response false'</xpath>
    </assert>
  </test>

  <test name="rcl:if with nested rcl:include">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <rcl:include>
                  <p>Included block</p>
                </rcl:include>
              </rcl:true>
            </rcl:if>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div/p/text()='Included block'</xpath>
    </assert>
  </test>

  <test name="Sequence of five rcl:if statements">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Response true</p>
              </rcl:true>
              <rcl:false>
                <p>Response false</p>
              </rcl:false>
            </rcl:if>
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Response true</p>
              </rcl:true>
              <rcl:false>
                <p>Response false</p>
              </rcl:false>
            </rcl:if>
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Response true</p>
              </rcl:true>
              <rcl:false>
                <p>Response false</p>
              </rcl:false>
            </rcl:if>
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Response true</p>
              </rcl:true>
              <rcl:false>
                <p>Response false</p>
              </rcl:false>
            </rcl:if>
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Response true</p>
              </rcl:true>
              <rcl:false>
                <p>Response false</p>
              </rcl:false>
            </rcl:if>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <!-- How do I prove with XPath that the name space specification is removed? -->
      <xpath>/div/p[1]/text()='Response true'</xpath>
      <xpath>/div/p[2]/text()='Response true'</xpath>
      <xpath>/div/p[3]/text()='Response true'</xpath>
      <xpath>/div/p[4]/text()='Response true'</xpath>
      <xpath>/div/p[5]/text()='Response true'</xpath>
    </assert>
  </test>

  <test name="rcl:if in a sequence of p elements">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <p>First paragraph</p>
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Second paragraph</p>
              </rcl:true>
            </rcl:if>
            <p>Third paragraph</p>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <xpath>/div/p[1]/text()='First paragraph'</xpath>
      <xpath>/div/p[2]/text()='Second paragraph'</xpath>
      <xpath>/div/p[3]/text()='Third paragraph'</xpath>
    </assert>
  </test>

  <test name="Two rcl:if elements separated by a  p element">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>First paragraph</p>
              </rcl:true>
            </rcl:if>
            <p>Middle paragraph</p>
            <rcl:if>
              <rcl:request>
                <rcl:identifier>active:true</rcl:identifier>
              </rcl:request>
              <rcl:true>
                <p>Last paragraph</p>
              </rcl:true>
            </rcl:if>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
      <xpath>/div/p[1]/text()='First paragraph'</xpath>
      <xpath>/div/p[2]/text()='Middle paragraph'</xpath>
      <xpath>/div/p[3]/text()='Last paragraph'</xpath>
    </assert>
  </test>


  <notest name="Unsupported Tab">
    <request>
      <identifier>active:rcl</identifier>
      <argument name="template">
        <literal type="xml">
          <div xmlns:rcl="http://netkernelroc.org/rcl">
            <rcl:unsupported>
              <p>Include this paragraph</p>
            </rcl:unsupported>
          </div>
        </literal>
      </argument>
      <representation>org.w3c.dom.Document</representation>
    </request>

    <assert>
      <notNull/>
    </assert>
  </notest>
</testlist>